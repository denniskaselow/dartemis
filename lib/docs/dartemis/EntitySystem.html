        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>EntitySystem abstract class / dartemis Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="dartemis" data-type="EntitySystem">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../dartemis.html">dartemis</a> &rsaquo; <a href="../dartemis/EntitySystem.html">EntitySystem</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="../dartemis.html">dartemis</a></h2><ul class="icon">
<li><a href="../dartemis/Aspect.html"><div class="icon-class"></div>Aspect</a></li>
<li><a href="../dartemis/Bag.html"><div class="icon-class"></div>Bag&lt;E&gt;</a></li>
<li><a href="../dartemis/Component.html"><div class="icon-class"></div>Component</a></li>
<li><a href="../dartemis/ComponentManager.html"><div class="icon-class"></div>ComponentManager</a></li>
<li><a href="../dartemis/ComponentMapper.html"><div class="icon-class"></div>ComponentMapper&lt;A&gt;</a></li>
<li><a href="../dartemis/ComponentType.html"><div class="icon-class"></div>ComponentType</a></li>
<li><a href="../dartemis/ComponentTypeManager.html"><div class="icon-class"></div>ComponentTypeManager</a></li>
<li><a href="../dartemis/DelayedEntityProcessingSystem.html"><div class="icon-class"></div>DelayedEntityProcessingSystem</a></li>
<li><a href="../dartemis/Entity.html"><div class="icon-class"></div>Entity</a></li>
<li><a href="../dartemis/EntityManager.html"><div class="icon-class"></div>EntityManager</a></li>
<li><a href="../dartemis/EntityObserver.html"><div class="icon-class"></div>EntityObserver</a></li>
<li><a href="../dartemis/EntityProcessingSystem.html"><div class="icon-class"></div>EntityProcessingSystem</a></li>
<li><div class="icon-class"></div><strong>EntitySystem</strong></li>
<li><a href="../dartemis/FastMath.html"><div class="icon-class"></div>FastMath</a></li>
<li><a href="../dartemis/GroupManager.html"><div class="icon-class"></div>GroupManager</a></li>
<li><a href="../dartemis/ImmutableBag.html"><div class="icon-interface"></div>ImmutableBag&lt;E&gt;</a></li>
<li><a href="../dartemis/IntervalEntityProcessingSystem.html"><div class="icon-class"></div>IntervalEntityProcessingSystem</a></li>
<li><a href="../dartemis/IntervalEntitySystem.html"><div class="icon-class"></div>IntervalEntitySystem</a></li>
<li><a href="../dartemis/Manager.html"><div class="icon-class"></div>Manager</a></li>
<li><a href="../dartemis/PlayerManager.html"><div class="icon-class"></div>PlayerManager</a></li>
<li><a href="../dartemis/TagManager.html"><div class="icon-class"></div>TagManager</a></li>
<li><a href="../dartemis/TeamManager.html"><div class="icon-class"></div>TeamManager</a></li>
<li><a href="../dartemis/Timer.html"><div class="icon-class"></div>Timer</a></li>
<li><a href="../dartemis/TrigUtil.html"><div class="icon-class"></div>TrigUtil</a></li>
<li><a href="../dartemis/Utils.html"><div class="icon-class"></div>Utils</a></li>
<li><a href="../dartemis/VoidEntitySystem.html"><div class="icon-class"></div>VoidEntitySystem</a></li>
<li><a href="../dartemis/World.html"><div class="icon-class"></div>World</a></li>
</ul>
</div>
<div class="content">
        <h2><strong>EntitySystem</strong>
          abstract class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>The most raw entity system. It should not typically be used, but you can create your own
entity system handling by extending this. It is recommended that you use the other provided
entity system implementations.</p>
<p>There is no need to ever call any other method than process on objects of this class.</p>
<p>@author Arni Arent</p>
<pre class="source">
abstract class EntitySystem implements EntityObserver {


  int _systemBit = 0;
  World world;
  Bag&lt;Entity&gt; _actives;

  int _all;
  int _excluded;
  int _one;
  bool _dummy;
  bool _passive;

  EntitySystem(Aspect aspect) : _actives = new Bag&lt;Entity&gt;(),
                                            _all = aspect.all,
                                            _excluded = aspect.excluded,
                                            _one = aspect.one {
    _dummy = _all == 0 &amp;&amp; _one == 0;
    _systemBit = _SystemBitManager._getBitFor(runtimeType);
  }

  get passive =&gt; _passive;

  /**
   * Called before processing of entities begins.
   */
  void begin() {}

  /**
   * This is the only method that is supposed to be called from outside the library,
   */
  void process() {
    if(checkProcessing()) {
      begin();
      processEntities(_actives);
      end();
    }
  }

  /**
   * Called after the processing of entities ends.
   */
  void end() {}

  /**
   * Any implementing entity system must implement this method and the logic
   * to process the given [entities] of the system.
   */
  abstract void processEntities(ImmutableBag&lt;Entity&gt; entities);

  /**
   * Returns true if the system should be processed, false if not.
   */
  abstract bool checkProcessing();

  /**
   * Override to implement code that gets executed when systems are initialized.
   */
  void initialize() {}

  /**
   * Called if the system has received an [entity] it is interested in, e.g. created or a component was added to it.
   */
  void inserted(Entity entity) {}

  /**
   * Called if an [entity] was removed from this system, e.g. deleted or had one of it's components removed.
   */
  void removed(Entity entity) {}

  void _check(Entity e) {
    if (_dummy) {
      return;
    }
    bool contains = _contains(e);
    bool interest = (_all &amp; e._typeBits) == _all;
    if (_one &gt; 0 &amp;&amp; interest) {
      interest = (_one &amp; e._typeBits) &gt; 0;
    }
    if (_excluded &gt; 0 &amp;&amp; interest) {
      interest = (_excluded &amp; e._typeBits) == 0;
    }

    if (interest &amp;&amp; !contains) {
      _insertToSystem(e);
    } else if (!interest &amp;&amp; contains) {
      _removeFromSystem(e);
    }
  }

  bool _contains(Entity e) =&gt; (_systemBit &amp; e._systemBits) == _systemBit;

  void _insertToSystem(Entity e) {
    _actives.add(e);
    e._addSystemBit(_systemBit);
    inserted(e);
  }

  void _removeFromSystem(Entity e) {
    _actives.remove(e);
    e._removeSystemBit(_systemBit);
    removed(e);
  }

  void added(Entity e) {
    _check(e);
  }

  void changed(Entity e) {
    _check(e);
  }

  void enabled(Entity e) {
    _check(e);
  }

  void deleted(Entity e) {
    if (_contains(e)) {
      _removeFromSystem(e);
    }
  }

  void disabled(Entity e) {
    if (_contains(e)) {
      _removeFromSystem(e);
    }
  }

}
</pre>
</div>
<h3>Subclasses</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../dartemis/DelayedEntityProcessingSystem.html">DelayedEntityProcessingSystem</a></span>, <span class="type-box"><span class="icon-class"></span><a href="../dartemis/EntityProcessingSystem.html">EntityProcessingSystem</a></span>, <span class="type-box"><span class="icon-class"></span><a href="../dartemis/IntervalEntitySystem.html">IntervalEntitySystem</a></span>, <span class="type-box"><span class="icon-class"></span><a href="../dartemis/VoidEntitySystem.html">VoidEntitySystem</a></span></p>
<h3>Implements</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../dartemis/EntityObserver.html">EntityObserver</a></span></p>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="EntitySystem">
<button class="show-code">Code</button>
new <strong>EntitySystem</strong>(<a href="../dartemis/Aspect.html">Aspect</a> aspect) <a class="anchor-link" href="#EntitySystem"
              title="Permalink to EntitySystem.EntitySystem">#</a></h4>
<div class="doc">
<pre class="source">
EntitySystem(Aspect aspect) : _actives = new Bag&lt;Entity&gt;(),
                                          _all = aspect.all,
                                          _excluded = aspect.excluded,
                                          _one = aspect.one {
  _dummy = _all == 0 &amp;&amp; _one == 0;
  _systemBit = _SystemBitManager._getBitFor(runtimeType);
}
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="passive">
<button class="show-code">Code</button>
final         <strong>passive</strong> <a class="anchor-link"
            href="#passive"
            title="Permalink to EntitySystem.passive">#</a>
        </h4>
        <div class="doc">
<pre class="source">
get passive =&gt; _passive;
</pre>
</div>
</div>
<div class="field inherited"><h4 id="runtimeType">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/Type.html">Type</a>         <strong>runtimeType</strong> <a class="anchor-link"
            href="#runtimeType"
            title="Permalink to EntitySystem.runtimeType">#</a>
        </h4>
        <div class="inherited-from">inherited from <a href="http://api.dartlang.org/dart_core/Object.html">Object</a> </div><div class="doc">
<p>A representation of the runtime type of the object.</p>
<pre class="source">
external Type get runtimeType;
</pre>
</div>
</div>
<div class="field"><h4 id="world">
<button class="show-code">Code</button>
<a href="../dartemis/World.html">World</a>         <strong>world</strong> <a class="anchor-link"
            href="#world"
            title="Permalink to EntitySystem.world">#</a>
        </h4>
        <div class="doc">
<pre class="source">
World world;
</pre>
</div>
</div>
</div>
<div>
<h3>Operators</h3>
<div class="method inherited"><h4 id="==">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/bool.html">bool</a> <strong>operator ==</strong>(other) <a class="anchor-link" href="#=="
              title="Permalink to EntitySystem.operator ==">#</a></h4>
<div class="inherited-from">inherited from <a href="http://api.dartlang.org/dart_core/Object.html">Object</a> </div><div class="doc">
<p>The equality operator.</p>
<p>The default behavior for all <code>Object</code>s is to return true if and
only if <code>this</code> and 
<span class="param">other</span> are the same object.</p>
<p>If a subclass overrides the equality operator it should override
the <code>hashCode</code> method as well to maintain consistency.</p>
<pre class="source">
bool operator ==(other) =&gt; identical(this, other);
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="added">
<button class="show-code">Code</button>
void <strong>added</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#added"
              title="Permalink to EntitySystem.added">#</a></h4>
<div class="doc">
<pre class="source">
void added(Entity e) {
  _check(e);
}
</pre>
</div>
</div>
<div class="method"><h4 id="begin">
<button class="show-code">Code</button>
void <strong>begin</strong>() <a class="anchor-link" href="#begin"
              title="Permalink to EntitySystem.begin">#</a></h4>
<div class="doc">
<p>Called before processing of entities begins.</p>
<pre class="source">
void begin() {}
</pre>
</div>
</div>
<div class="method"><h4 id="changed">
<button class="show-code">Code</button>
void <strong>changed</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#changed"
              title="Permalink to EntitySystem.changed">#</a></h4>
<div class="doc">
<pre class="source">
void changed(Entity e) {
  _check(e);
}
</pre>
</div>
</div>
<div class="method"><h4 id="checkProcessing">
abstract <a href="http://api.dartlang.org/dart_core/bool.html">bool</a> <strong>checkProcessing</strong>() <a class="anchor-link" href="#checkProcessing"
              title="Permalink to EntitySystem.checkProcessing">#</a></h4>
<div class="doc">
<p>Returns true if the system should be processed, false if not.</p>
</div>
</div>
<div class="method"><h4 id="deleted">
<button class="show-code">Code</button>
void <strong>deleted</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#deleted"
              title="Permalink to EntitySystem.deleted">#</a></h4>
<div class="doc">
<pre class="source">
void deleted(Entity e) {
  if (_contains(e)) {
    _removeFromSystem(e);
  }
}
</pre>
</div>
</div>
<div class="method"><h4 id="disabled">
<button class="show-code">Code</button>
void <strong>disabled</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#disabled"
              title="Permalink to EntitySystem.disabled">#</a></h4>
<div class="doc">
<pre class="source">
void disabled(Entity e) {
  if (_contains(e)) {
    _removeFromSystem(e);
  }
}
</pre>
</div>
</div>
<div class="method"><h4 id="enabled">
<button class="show-code">Code</button>
void <strong>enabled</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#enabled"
              title="Permalink to EntitySystem.enabled">#</a></h4>
<div class="doc">
<pre class="source">
void enabled(Entity e) {
  _check(e);
}
</pre>
</div>
</div>
<div class="method"><h4 id="end">
<button class="show-code">Code</button>
void <strong>end</strong>() <a class="anchor-link" href="#end"
              title="Permalink to EntitySystem.end">#</a></h4>
<div class="doc">
<p>Called after the processing of entities ends.</p>
<pre class="source">
void end() {}
</pre>
</div>
</div>
<div class="method"><h4 id="EntitySystem">
<button class="show-code">Code</button>
new <strong>EntitySystem</strong>(<a href="../dartemis/Aspect.html">Aspect</a> aspect) <a class="anchor-link" href="#EntitySystem"
              title="Permalink to EntitySystem.EntitySystem">#</a></h4>
<div class="doc">
<pre class="source">
EntitySystem(Aspect aspect) : _actives = new Bag&lt;Entity&gt;(),
                                          _all = aspect.all,
                                          _excluded = aspect.excluded,
                                          _one = aspect.one {
  _dummy = _all == 0 &amp;&amp; _one == 0;
  _systemBit = _SystemBitManager._getBitFor(runtimeType);
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="hashCode">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/int.html">int</a> <strong>hashCode</strong>() <a class="anchor-link" href="#hashCode"
              title="Permalink to EntitySystem.hashCode">#</a></h4>
<div class="inherited-from">inherited from <a href="http://api.dartlang.org/dart_core/Object.html">Object</a> </div><div class="doc">
<p>Get a hash code for this object.</p>
<p>All objects have hash codes. Hash codes are guaranteed to be the
same for objects that are equal when compared using the equality
operator <code>==</code>. Other than that there are no guarantees about
the hash codes. They will not be consistent between runs and
there are no distribution guarantees.</p>
<p>If a subclass overrides <code>hashCode</code> it should override the
equality operator as well to maintain consistency.</p>
<pre class="source">
external int hashCode();
</pre>
</div>
</div>
<div class="method"><h4 id="initialize">
<button class="show-code">Code</button>
void <strong>initialize</strong>() <a class="anchor-link" href="#initialize"
              title="Permalink to EntitySystem.initialize">#</a></h4>
<div class="doc">
<p>Override to implement code that gets executed when systems are initialized.</p>
<pre class="source">
void initialize() {}
</pre>
</div>
</div>
<div class="method"><h4 id="inserted">
<button class="show-code">Code</button>
void <strong>inserted</strong>(<a href="../dartemis/Entity.html">Entity</a> entity) <a class="anchor-link" href="#inserted"
              title="Permalink to EntitySystem.inserted">#</a></h4>
<div class="doc">
<p>Called if the system has received an 
<span class="param">entity</span> it is interested in, e.g. created or a component was added to it.</p>
<pre class="source">
void inserted(Entity entity) {}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="noSuchMethod">
<button class="show-code">Code</button>
<strong>noSuchMethod</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> name, <a href="http://api.dartlang.org/dart_core/List.html">List</a> args) <a class="anchor-link" href="#noSuchMethod"
              title="Permalink to EntitySystem.noSuchMethod">#</a></h4>
<div class="inherited-from">inherited from <a href="http://api.dartlang.org/dart_core/Object.html">Object</a> </div><div class="doc">
<p><code>noSuchMethod</code> is invoked when users invoke a non-existant method
on an object. The name of the method and the arguments of the
invocation are passed to <code>noSuchMethod</code>. If <code>noSuchMethod</code>
returns a value, that value becomes the result of the original
invocation.</p>
<p>The default behavior of <code>noSuchMethod</code> is to throw a
<code>noSuchMethodError</code>.</p>
<pre class="source">
external Dynamic noSuchMethod(String name, List args);
</pre>
</div>
</div>
<div class="method inherited"><h4 id="Object">
<button class="show-code">Code</button>
const <strong>Object</strong>() <a class="anchor-link" href="#Object"
              title="Permalink to EntitySystem.Object">#</a></h4>
<div class="inherited-from">inherited from <a href="http://api.dartlang.org/dart_core/Object.html">Object</a> </div><div class="doc">
<p>Creates a new <code>Object</code> instance.</p>
<p><code>Object</code> instances have no meaningful state, and are only useful
through their identity. An <code>Object</code> instance is equal to itself
only.</p>
<pre class="source">
const Object();
</pre>
</div>
</div>
<div class="method"><h4 id="process">
<button class="show-code">Code</button>
void <strong>process</strong>() <a class="anchor-link" href="#process"
              title="Permalink to EntitySystem.process">#</a></h4>
<div class="doc">
<p>This is the only method that is supposed to be called from outside the library,</p>
<pre class="source">
void process() {
  if(checkProcessing()) {
    begin();
    processEntities(_actives);
    end();
  }
}
</pre>
</div>
</div>
<div class="method"><h4 id="processEntities">
abstract void <strong>processEntities</strong>(<a href="../dartemis/ImmutableBag.html">ImmutableBag</a>&lt;<a href="../dartemis/Entity.html">Entity</a>&gt; entities) <a class="anchor-link" href="#processEntities"
              title="Permalink to EntitySystem.processEntities">#</a></h4>
<div class="doc">
<p>Any implementing entity system must implement this method and the logic
to process the given 
<span class="param">entities</span> of the system.</p>
</div>
</div>
<div class="method"><h4 id="removed">
<button class="show-code">Code</button>
void <strong>removed</strong>(<a href="../dartemis/Entity.html">Entity</a> entity) <a class="anchor-link" href="#removed"
              title="Permalink to EntitySystem.removed">#</a></h4>
<div class="doc">
<p>Called if an 
<span class="param">entity</span> was removed from this system, e.g. deleted or had one of it's components removed.</p>
<pre class="source">
void removed(Entity entity) {}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="toString">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/String.html">String</a> <strong>toString</strong>() <a class="anchor-link" href="#toString"
              title="Permalink to EntitySystem.toString">#</a></h4>
<div class="inherited-from">inherited from <a href="http://api.dartlang.org/dart_core/Object.html">Object</a> </div><div class="doc">
<p>Returns a string representation of this object.</p>
<pre class="source">
external String toString();
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        
        <div class="footer">
          <div>This page was generated at 2012-10-21 15:45:50.243</div>
        </div>
        <script async src="../client-static.js"></script>
        </body></html>
        

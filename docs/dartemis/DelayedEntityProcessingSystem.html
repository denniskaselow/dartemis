        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>DelayedEntityProcessingSystem abstract class / dartemis Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="dartemis" data-type="DelayedEntityProcessingSystem">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../dartemis.html">dartemis</a> &rsaquo; <a href="../dartemis/DelayedEntityProcessingSystem.html">DelayedEntityProcessingSystem</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="../dartemis.html">dartemis</a></h2><ul class="icon">
<li><a href="../dartemis/Aspect.html"><div class="icon-class"></div>Aspect</a></li>
<li><a href="../dartemis/Bag.html"><div class="icon-class"></div>Bag&lt;E&gt;</a></li>
<li><a href="../dartemis/Component.html"><div class="icon-class"></div>Component</a></li>
<li><a href="../dartemis/ComponentManager.html"><div class="icon-class"></div>ComponentManager</a></li>
<li><a href="../dartemis/ComponentMapper.html"><div class="icon-class"></div>ComponentMapper&lt;A&gt;</a></li>
<li><a href="../dartemis/ComponentPoolable.html"><div class="icon-class"></div>ComponentPoolable</a></li>
<li><a href="../dartemis/ComponentType.html"><div class="icon-class"></div>ComponentType</a></li>
<li><a href="../dartemis/ComponentTypeManager.html"><div class="icon-class"></div>ComponentTypeManager</a></li>
<li><a href="../dartemis/CreatePoolable.html"><div class="icon-interface"></div>CreatePoolable</a></li>
<li><div class="icon-class"></div><strong>DelayedEntityProcessingSystem</strong></li>
<li><a href="../dartemis/Entity.html"><div class="icon-class"></div>Entity</a></li>
<li><a href="../dartemis/EntityManager.html"><div class="icon-class"></div>EntityManager</a></li>
<li><a href="../dartemis/EntityObserver.html"><div class="icon-class"></div>EntityObserver</a></li>
<li><a href="../dartemis/EntityProcessingSystem.html"><div class="icon-class"></div>EntityProcessingSystem</a></li>
<li><a href="../dartemis/EntitySystem.html"><div class="icon-class"></div>EntitySystem</a></li>
<li><a href="../dartemis/FastMath.html"><div class="icon-class"></div>FastMath</a></li>
<li><a href="../dartemis/GroupManager.html"><div class="icon-class"></div>GroupManager</a></li>
<li><a href="../dartemis/IntervalEntityProcessingSystem.html"><div class="icon-class"></div>IntervalEntityProcessingSystem</a></li>
<li><a href="../dartemis/IntervalEntitySystem.html"><div class="icon-class"></div>IntervalEntitySystem</a></li>
<li><a href="../dartemis/Manager.html"><div class="icon-class"></div>Manager</a></li>
<li><a href="../dartemis/ObjectPool.html"><div class="icon-class"></div>ObjectPool</a></li>
<li><a href="../dartemis/PlayerManager.html"><div class="icon-class"></div>PlayerManager</a></li>
<li><a href="../dartemis/Poolable.html"><div class="icon-class"></div>Poolable</a></li>
<li><a href="../dartemis/ReadOnlyBag.html"><div class="icon-class"></div>ReadOnlyBag&lt;E&gt;</a></li>
<li><a href="../dartemis/TagManager.html"><div class="icon-class"></div>TagManager</a></li>
<li><a href="../dartemis/TeamManager.html"><div class="icon-class"></div>TeamManager</a></li>
<li><a href="../dartemis/Utils.html"><div class="icon-class"></div>Utils</a></li>
<li><a href="../dartemis/VoidEntitySystem.html"><div class="icon-class"></div>VoidEntitySystem</a></li>
<li><a href="../dartemis/World.html"><div class="icon-class"></div>World</a></li>
</ul>
</div>
<div class="content">
        <h2><strong>DelayedEntityProcessingSystem</strong>
          abstract class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>The purpose of this class is to allow systems to execute at varying intervals.</p>
<p>An example system would be an ExpirationSystem, that deletes entities after a certain
lifetime. Instead of running a system that decrements a timeLeft value for each
entity, you can simply use this system to execute in a future at a time of the shortest
lived entity, and then reset the system to run at a time in a future at a time of the
shortest lived entity, etc.</p>
<p>Another example system would be an AnimationSystem. You know when you have to animate
a certain entity, e.g. in 300 milliseconds. So you can set the system to run in 300 ms.
to perform the animation.</p>
<p>This will save CPU cycles in some scenarios.</p>
<p>Implementation notes:
In order to start the system you need to override the inserted(Entity e) method,
look up the delay time from that entity and offer it to the system by using the
offerDelay(num delay) method.
Also, when processing the entities you must also call offerDelay(num delay)
for all valid entities.</p>
<pre class="source">
abstract class DelayedEntityProcessingSystem extends EntitySystem {
 num _delay;
 bool _running;
 num _acc;

 DelayedEntityProcessingSystem(Aspect aspect) : super(aspect);

 /**
  * Check if the system is counting down towards processing.
  */
 bool get running =&gt; _running;

 /**
  * Return the delay until this entity should be processed.
  */
 num getRemainingDelay(Entity e);

 /**
  * Process a entity this system is interested in. Substract the accumulatedDelta
  * from the entities defined delay.
  */
 void processDelta(Entity e, num accumulatedDelta);

 void processExpired(Entity e);

 void processEntities(ReadOnlyBag&lt;Entity&gt; entities) {
   entities.forEach((entity) {
     processDelta(entity, _acc);
     num remaining = getRemainingDelay(entity);
     if(remaining &lt;= 0) {
       processExpired(entity);
     } else {
       offerDelay(remaining);
     }
   });
   stop();
 }

 void inserted(Entity e) {
   num delay = getRemainingDelay(e);
   if(delay &gt; 0) {
     offerDelay(delay);
   }
 }

 bool checkProcessing() {
   if(_running) {
     _acc += world.delta;

     if(_acc &gt;= _delay) {
       return true;
     }
   }
   return false;
 }

 /**
  * Start processing of entities after a certain amount of delta time.
  *
  * Cancels current delayed run and starts a new one.
  */
 void restart(num delay) {
   this._delay = delay;
   this._acc = 0;
   _running = true;
 }

 /**
  * Restarts the system only if the delay offered is shorter than the
  * time that the system is currently scheduled to execute at.
  *
  * If the system is already stopped (not running) then the offered
  * delay will be used to restart the system with no matter its value.
  *
  * If the system is already counting down, and the offered delay is
  * larger than the time remaining, the system will ignore it. If the
  * offered delay is shorter than the time remaining, the system will
  * restart itself to run at the offered delay.
  */
 void offerDelay(num delay) {
   if(!_running || delay &lt; getRemainingTimeUntilProcessing()) {
     restart(delay);
   }
 }

 /**
  * Get the initial delay that the system was ordered to process entities after.
  */
 num getInitialTimeDelay() =&gt; _delay;

 /**
  * Get the time until the system is scheduled to run at.
  * Returns zero (0) if the system is not running.
  * Use isRunning() before checking this value.
  */
 num getRemainingTimeUntilProcessing() {
   if(_running) {
     return _delay-_acc;
   }
   return 0;
 }

 /**
  * Stops the system from running, aborts current countdown.
  * Call offerDelay or restart to run it again.
  */
 void stop() {
   this._running = false;
   this._acc = 0;
 }

}
</pre>
</div>
<h3>Extends</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../dartemis/EntitySystem.html">EntitySystem</a></span>&nbsp;&gt;&nbsp;<span class="type-box"><span class="icon-class"></span><strong>DelayedEntityProcessingSystem</strong></span></p>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="DelayedEntityProcessingSystem">
<button class="show-code">Code</button>
new <strong>DelayedEntityProcessingSystem</strong>(<a href="../dartemis/Aspect.html">Aspect</a> aspect) <a class="anchor-link" href="#DelayedEntityProcessingSystem"
              title="Permalink to DelayedEntityProcessingSystem.DelayedEntityProcessingSystem">#</a></h4>
<div class="doc">
<pre class="source">
DelayedEntityProcessingSystem(Aspect aspect) : super(aspect);
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field inherited"><h4 id="passive">
<button class="show-code">Code</button>
final         <strong>passive</strong> <a class="anchor-link"
            href="#passive"
            title="Permalink to DelayedEntityProcessingSystem.passive">#</a>
        </h4>
        <div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<pre class="source">
get passive =&gt; _passive;
</pre>
</div>
</div>
<div class="field"><h4 id="running">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/bool.html">bool</a>         <strong>running</strong> <a class="anchor-link"
            href="#running"
            title="Permalink to DelayedEntityProcessingSystem.running">#</a>
        </h4>
        <div class="doc">
<p>Check if the system is counting down towards processing.</p>
<pre class="source">
bool get running =&gt; _running;
</pre>
</div>
</div>
<div class="field inherited"><h4 id="world">
<button class="show-code">Code</button>
<a href="../dartemis/World.html">World</a>         <strong>world</strong> <a class="anchor-link"
            href="#world"
            title="Permalink to DelayedEntityProcessingSystem.world">#</a>
        </h4>
        <div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<pre class="source">
World world
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method inherited"><h4 id="added">
<button class="show-code">Code</button>
void <strong>added</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#added"
              title="Permalink to DelayedEntityProcessingSystem.added">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<pre class="source">
void added(Entity e) =&gt; _check(e);
</pre>
</div>
</div>
<div class="method inherited"><h4 id="begin">
<button class="show-code">Code</button>
void <strong>begin</strong>() <a class="anchor-link" href="#begin"
              title="Permalink to DelayedEntityProcessingSystem.begin">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<p>Called before processing of entities begins.</p>
<pre class="source">
void begin() {}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="changed">
<button class="show-code">Code</button>
void <strong>changed</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#changed"
              title="Permalink to DelayedEntityProcessingSystem.changed">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<pre class="source">
void changed(Entity e) =&gt; _check(e);
</pre>
</div>
</div>
<div class="method"><h4 id="checkProcessing">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/bool.html">bool</a> <strong>checkProcessing</strong>() <a class="anchor-link" href="#checkProcessing"
              title="Permalink to DelayedEntityProcessingSystem.checkProcessing">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Returns true if the system should be processed, false if not.</p>
<div class="docs-inherited-from">docs inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div></div>
<pre class="source">
bool checkProcessing() {
 if(_running) {
   _acc += world.delta;

   if(_acc &gt;= _delay) {
     return true;
   }
 }
 return false;
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="deleted">
<button class="show-code">Code</button>
void <strong>deleted</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#deleted"
              title="Permalink to DelayedEntityProcessingSystem.deleted">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<pre class="source">
void deleted(Entity e) {
 if (_contains(e)) {
   _removeFromSystem(e);
 }
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="disabled">
<button class="show-code">Code</button>
void <strong>disabled</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#disabled"
              title="Permalink to DelayedEntityProcessingSystem.disabled">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<pre class="source">
void disabled(Entity e) {
 if (_contains(e)) {
   _removeFromSystem(e);
 }
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="enabled">
<button class="show-code">Code</button>
void <strong>enabled</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#enabled"
              title="Permalink to DelayedEntityProcessingSystem.enabled">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<pre class="source">
void enabled(Entity e) =&gt; _check(e);
</pre>
</div>
</div>
<div class="method inherited"><h4 id="end">
<button class="show-code">Code</button>
void <strong>end</strong>() <a class="anchor-link" href="#end"
              title="Permalink to DelayedEntityProcessingSystem.end">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<p>Called after the processing of entities ends.</p>
<pre class="source">
void end() {}
</pre>
</div>
</div>
<div class="method"><h4 id="getInitialTimeDelay">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/num.html">num</a> <strong>getInitialTimeDelay</strong>() <a class="anchor-link" href="#getInitialTimeDelay"
              title="Permalink to DelayedEntityProcessingSystem.getInitialTimeDelay">#</a></h4>
<div class="doc">
<p>Get the initial delay that the system was ordered to process entities after.</p>
<pre class="source">
num getInitialTimeDelay() =&gt; _delay;
</pre>
</div>
</div>
<div class="method"><h4 id="getRemainingDelay">
abstract <a href="http://api.dartlang.org/dart_core/num.html">num</a> <strong>getRemainingDelay</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#getRemainingDelay"
              title="Permalink to DelayedEntityProcessingSystem.getRemainingDelay">#</a></h4>
<div class="doc">
<p>Return the delay until this entity should be processed.</p>
</div>
</div>
<div class="method"><h4 id="getRemainingTimeUntilProcessing">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/num.html">num</a> <strong>getRemainingTimeUntilProcessing</strong>() <a class="anchor-link" href="#getRemainingTimeUntilProcessing"
              title="Permalink to DelayedEntityProcessingSystem.getRemainingTimeUntilProcessing">#</a></h4>
<div class="doc">
<p>Get the time until the system is scheduled to run at.
Returns zero (0) if the system is not running.
Use isRunning() before checking this value.</p>
<pre class="source">
num getRemainingTimeUntilProcessing() {
 if(_running) {
   return _delay-_acc;
 }
 return 0;
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="initialize">
<button class="show-code">Code</button>
void <strong>initialize</strong>() <a class="anchor-link" href="#initialize"
              title="Permalink to DelayedEntityProcessingSystem.initialize">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<p>Override to implement code that gets executed when systems are initialized.</p>
<pre class="source">
void initialize() {}
</pre>
</div>
</div>
<div class="method"><h4 id="inserted">
<button class="show-code">Code</button>
void <strong>inserted</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#inserted"
              title="Permalink to DelayedEntityProcessingSystem.inserted">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Called if the system has received an <code>entity</code> it is interested in, e.g. created or a component was added to it.</p>
<div class="docs-inherited-from">docs inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div></div>
<pre class="source">
void inserted(Entity e) {
 num delay = getRemainingDelay(e);
 if(delay &gt; 0) {
   offerDelay(delay);
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="offerDelay">
<button class="show-code">Code</button>
void <strong>offerDelay</strong>(<a href="http://api.dartlang.org/dart_core/num.html">num</a> delay) <a class="anchor-link" href="#offerDelay"
              title="Permalink to DelayedEntityProcessingSystem.offerDelay">#</a></h4>
<div class="doc">
<p>Restarts the system only if the delay offered is shorter than the
time that the system is currently scheduled to execute at.</p>
<p>If the system is already stopped (not running) then the offered
delay will be used to restart the system with no matter its value.</p>
<p>If the system is already counting down, and the offered delay is
larger than the time remaining, the system will ignore it. If the
offered delay is shorter than the time remaining, the system will
restart itself to run at the offered delay.</p>
<pre class="source">
void offerDelay(num delay) {
 if(!_running || delay &lt; getRemainingTimeUntilProcessing()) {
   restart(delay);
 }
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="process">
<button class="show-code">Code</button>
void <strong>process</strong>() <a class="anchor-link" href="#process"
              title="Permalink to DelayedEntityProcessingSystem.process">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<p>This is the only method that is supposed to be called from outside the library,</p>
<pre class="source">
void process() {
 if(checkProcessing()) {
   begin();
   processEntities(_actives.readOnly);
   end();
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="processDelta">
abstract void <strong>processDelta</strong>(<a href="../dartemis/Entity.html">Entity</a> e, <a href="http://api.dartlang.org/dart_core/num.html">num</a> accumulatedDelta) <a class="anchor-link" href="#processDelta"
              title="Permalink to DelayedEntityProcessingSystem.processDelta">#</a></h4>
<div class="doc">
<p>Process a entity this system is interested in. Substract the accumulatedDelta
from the entities defined delay.</p>
</div>
</div>
<div class="method"><h4 id="processEntities">
<button class="show-code">Code</button>
void <strong>processEntities</strong>(<a href="../dartemis/ReadOnlyBag.html">ReadOnlyBag</a>&lt;<a href="../dartemis/Entity.html">Entity</a>&gt; entities) <a class="anchor-link" href="#processEntities"
              title="Permalink to DelayedEntityProcessingSystem.processEntities">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Any implementing entity system must implement this method and the logic
to process the given 
<span class="param">entities</span> of the system.</p>
<div class="docs-inherited-from">docs inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div></div>
<pre class="source">
void processEntities(ReadOnlyBag&lt;Entity&gt; entities) {
 entities.forEach((entity) {
   processDelta(entity, _acc);
   num remaining = getRemainingDelay(entity);
   if(remaining &lt;= 0) {
     processExpired(entity);
   } else {
     offerDelay(remaining);
   }
 });
 stop();
}
</pre>
</div>
</div>
<div class="method"><h4 id="processExpired">
abstract void <strong>processExpired</strong>(<a href="../dartemis/Entity.html">Entity</a> e) <a class="anchor-link" href="#processExpired"
              title="Permalink to DelayedEntityProcessingSystem.processExpired">#</a></h4>
<div class="doc">
</div>
</div>
<div class="method inherited"><h4 id="removed">
<button class="show-code">Code</button>
void <strong>removed</strong>(<a href="../dartemis/Entity.html">Entity</a> entity) <a class="anchor-link" href="#removed"
              title="Permalink to DelayedEntityProcessingSystem.removed">#</a></h4>
<div class="inherited-from">inherited from <a href="../dartemis/EntitySystem.html">EntitySystem</a> </div><div class="doc">
<p>Called if an 
<span class="param">entity</span> was removed from this system, e.g. deleted or had one of it's components removed.</p>
<pre class="source">
void removed(Entity entity) {}
</pre>
</div>
</div>
<div class="method"><h4 id="restart">
<button class="show-code">Code</button>
void <strong>restart</strong>(<a href="http://api.dartlang.org/dart_core/num.html">num</a> delay) <a class="anchor-link" href="#restart"
              title="Permalink to DelayedEntityProcessingSystem.restart">#</a></h4>
<div class="doc">
<p>Start processing of entities after a certain amount of delta time.</p>
<p>Cancels current delayed run and starts a new one.</p>
<pre class="source">
void restart(num delay) {
 this._delay = delay;
 this._acc = 0;
 _running = true;
}
</pre>
</div>
</div>
<div class="method"><h4 id="stop">
<button class="show-code">Code</button>
void <strong>stop</strong>() <a class="anchor-link" href="#stop"
              title="Permalink to DelayedEntityProcessingSystem.stop">#</a></h4>
<div class="doc">
<p>Stops the system from running, aborts current countdown.
Call offerDelay or restart to run it again.</p>
<pre class="source">
void stop() {
 this._running = false;
 this._acc = 0;
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-04-20 15:22:34.735</div>
        </div>
        <script async src="../client-static.js"></script>
        </body></html>
        
